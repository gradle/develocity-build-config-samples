name: Maven smoke test

on: [push]

jobs:
    verify-enterprise-sample:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout
              uses: actions/checkout@v2
            - name: Prepare Maven environment
              uses: ./.github/workflows/composite/maven-prepare
              with:
                  project-basedir: common-gradle-enterprise-maven-configuration
            - name: Run and check
              uses: ./.github/workflows/composite/maven-run-and-check
              with:
                  project-basedir: common-gradle-enterprise-maven-configuration

    verify-maven-samples:
        runs-on: ubuntu-latest

        strategy:
            matrix:
                include:
                    - relative-path-to-sample-build-file: "default"
                    - relative-path-to-sample-build-file: "capture-os-processes/maven-os-processes.groovy"
                    - relative-path-to-sample-build-file: "capture-quality-check-issues/maven-quality-check-issues.groovy"
                    - relative-path-to-sample-build-file: "capture-top-level-project/maven-top-level-project.groovy"

        steps:
            - name: Checkout
              uses: actions/checkout@v2
            - name: Prepare
              uses: ./.github/workflows/composite/maven-prepare
              with:
                  project-basedir: common-custom-user-data-maven-extension
            - name: Copy current sample
              run: |
                  # default uses the original gradle-enterprise-custom-user-data.groovy
                  if [[ ${{ matrix.relative-path-to-sample-build-file }} != "default" ]]; then
                      cp ${{ matrix.relative-path-to-sample-build-file }} common-custom-user-data-maven-extension/.mvn/gradle-enterprise-custom-user-data.groovy
                  fi
            - name: Run and check
              uses: ./.github/workflows/composite/maven-run-and-check
              with:
                  project-basedir: common-custom-user-data-maven-extension
