<?xml version="1.0" encoding="UTF-8"?>

<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd https://www.gradle.com/schema/develocity-maven-project.xsd">
  <modelVersion>4.0.0</modelVersion>
  <artifactId>webstart-project</artifactId>
  <packaging>jar</packaging>

  <parent>
    <groupId>com.example</groupId>
    <artifactId>develocity-maven-caching-sample</artifactId>
    <version>1.0-SNAPSHOT</version>
  </parent>

  <dependencies>
    <dependency>
      <groupId>org.apache.commons</groupId>
      <artifactId>commons-lang3</artifactId>
      <version>3.18.0</version>
    </dependency>
    <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-logging</artifactId>
      <version>2.2.4.RELEASE</version>
    </dependency>
  </dependencies>

  <build>
    <plugins>
      <plugin>
        <groupId>org.codehaus.mojo</groupId>
        <artifactId>webstart-maven-plugin</artifactId>
        <version>1.0-beta-7</version>
        <executions>
          <execution>
            <goals>
              <goal>jnlp-single</goal>
            </goals>
            <phase>package</phase>
          </execution>
        </executions>
        <configuration>
          <jnlp>
            <mainClass>com.example.App</mainClass>
            <properties>
              <foo>bar</foo>
            </properties>
          </jnlp>
          <sign>
            <keystore>${project.build.directory}/keystore</keystore>
            <keypass>fillme</keypass>
            <storepass>fillme</storepass>
            <alias>fillme</alias>

            <dnameCn>fillme</dnameCn>
            <dnameOu>fillme</dnameOu>
            <dnameO>fillme</dnameO>
            <dnameL>fillme</dnameL>
            <dnameSt>fillme</dnameSt>
            <dnameC>fillme</dnameC>

            <verify>true</verify>

            <keystoreConfig>
              <delete>true</delete>
              <gen>true</gen>
            </keystoreConfig>
          </sign>
        </configuration>
      </plugin>
    </plugins>
    <pluginManagement>
      <plugins>
        <plugin>
          <groupId>com.gradle</groupId>
          <artifactId>develocity-maven-extension</artifactId>
          <configuration>
            <develocity>
              <plugins>
                <plugin>
                  <groupId>org.codehaus.mojo</groupId>
                  <artifactId>webstart-maven-plugin</artifactId>
                  <inputs>
                    <fileSets>
                      <fileSet>
                        <name>templateDirectory</name>
                        <normalization>IGNORED_PATH</normalization>
                      </fileSet>
                      <fileSet>
                        <name>resourcesDirectory</name>
                        <normalization>RELATIVE_PATH</normalization>
                      </fileSet>
                      <fileSet>
                        <!-- used to find the keystore if the location is prefixed with classpath: -->
                        <name>compileClassPath</name>
                        <normalization>CLASSPATH</normalization>
                      </fileSet>
                    </fileSets>
                    <properties>
                      <property>
                        <name>filenameMapping</name>
                      </property>
                      <property>
                        <name>canUnsign</name>
                      </property>
                      <property>
                        <name>codebase</name>
                      </property>
                      <property>
                        <name>encoding</name>
                      </property>
                      <property>
                        <name>excludeTransitive</name>
                      </property>
                      <property>
                        <name>gzip</name>
                      </property>
                      <property>
                        <name>libPath</name>
                      </property>
                      <property>
                        <name>makeArchive</name>
                      </property>
                      <property>
                        <name>outputJarVersions</name>
                      </property>
                      <property>
                        <name>unsignAlreadySignedJars</name>
                      </property>
                      <property>
                        <name>updateManifestEntries</name>
                      </property>
                      <property>
                        <name>useUniqueVersions</name>
                      </property>
                    </properties>
                    <ignoredProperties>
                      <!-- Attaching the archive to the project does not work when using the cache -->
                      <ignore>attachArchive</ignore>
                      <!-- deprecated property is not used by the mojo implementation -->
                      <ignore>keystore</ignore>
                      <ignore>verbose</ignore>
                      <!-- only used for logging -->
                      <ignore>basedir</ignore>
                      <ignore>localRepository</ignore>
                      <ignore>project</ignore>
                      <ignore>remoteRepositories</ignore>
                    </ignoredProperties>
                  </inputs>
                  <iteratedProperties>
                    <property>
                      <name>dependencies</name>
                      <inputs>
                        <properties>
                          <property>
                            <name>includes</name>
                          </property>
                          <property>
                            <name>excludes</name>
                          </property>
                        </properties>
                      </inputs>
                    </property>
                    <property>
                      <!-- JnlpExtensions extends JnlpConfig so we need to duplicate everthing from the jnlp property here -->
                      <name>jnlpExtensions</name>
                      <inputs>
                        <fileSets>
                          <fileSet>
                            <!--
                              Template is processed by velocity and has access to:
                                - System properties
                                - Maven project properties
                              If a custom template is used and it accesses system properties or project properties, those have to be added as inputs
                            -->
                            <name>inputTemplateResourcePath</name>
                            <normalization>IGNORED_PATH</normalization>
                          </fileSet>
                          <fileSet>
                            <name>resources</name>
                            <normalization>RELATIVE_PATH</normalization>
                          </fileSet>
                        </fileSets>
                        <properties>
                          <!-- JnlpConfig properties -->
                          <property>
                            <name>spec</name>
                          </property>
                          <property>
                            <name>version</name>
                          </property>
                          <property>
                            <name>j2seVersion</name>
                          </property>
                          <property>
                            <name>allPermissions</name>
                          </property>
                          <property>
                            <!-- File name of the jnlp file inside the output directory -->
                            <name>outputFile</name>
                          </property>
                          <property>
                            <name>offlineAllowed</name>
                          </property>
                          <property>
                            <name>href</name>
                          </property>
                          <property>
                            <name>mainClass</name>
                          </property>
                          <property>
                            <name>type</name>
                          </property>
                          <property>
                            <name>properties</name>
                          </property>
                          <property>
                            <name>inputTemplate</name>
                          </property>
                          <!-- additional JnlpExntesion properties -->
                          <property>
                            <name>name</name>
                          </property>
                          <property>
                            <name>title</name>
                          </property>
                          <property>
                            <name>vendor</name>
                          </property>
                          <property>
                            <name>homepage</name>
                          </property>
                          <property>
                            <name>description</name>
                          </property>
                          <property>
                            <name>includes</name>
                          </property>
                        </properties>
                      </inputs>
                    </property>
                  </iteratedProperties>
                  <nestedProperties>
                    <property>
                      <name>jnlp</name>
                      <inputs>
                        <fileSets>
                          <fileSet>
                            <name>inputTemplateResourcePath</name>
                            <normalization>IGNORED_PATH</normalization>
                          </fileSet>
                          <fileSet>
                            <name>resources</name>
                            <normalization>RELATIVE_PATH</normalization>
                          </fileSet>
                        </fileSets>
                        <properties>
                          <property>
                            <name>spec</name>
                          </property>
                          <property>
                            <name>version</name>
                          </property>
                          <property>
                            <name>j2seVersion</name>
                          </property>
                          <property>
                            <name>allPermissions</name>
                          </property>
                          <property>
                            <!-- File name of the jnlp file inside the output directory -->
                            <name>outputFile</name>
                          </property>
                          <property>
                            <name>offlineAllowed</name>
                          </property>
                          <property>
                            <name>href</name>
                          </property>
                          <property>
                            <name>mainClass</name>
                          </property>
                          <property>
                            <name>type</name>
                          </property>
                          <property>
                            <name>properties</name>
                          </property>
                          <property>
                            <name>inputTemplate</name>
                          </property>
                        </properties>
                      </inputs>
                    </property>
                    <property>
                      <name>pack200</name>
                      <inputs>
                        <properties>
                          <property>
                            <name>enabled</name>
                          </property>
                          <property>
                            <name>passFiles</name>
                          </property>
                        </properties>
                      </inputs>
                    </property>
                    <property>
                      <name>sign</name>
                      <inputs>
                        <fileSets>
                          <fileSet>
                            <name>workDirectory</name>
                            <normalization>RELATIVE_PATH</normalization>
                          </fileSet>
                          <fileSet>
                            <name>keystore</name>
                            <normalization>IGNORED_PATH</normalization>
                          </fileSet>
                          <fileSet>
                            <name>workingKeystore</name>
                            <normalization>IGNORED_PATH</normalization>
                          </fileSet>
                        </fileSets>
                        <properties>
                          <property>
                            <name>keyalg</name>
                          </property>
                          <property>
                            <name>sigalg</name>
                          </property>
                          <property>
                            <name>sigfile</name>
                          </property>
                           <property>
                            <name>storepass</name>
                          </property>
                          <property>
                            <name>keypass</name>
                          </property>
                          <property>
                            <name>validity</name>
                          </property>
                          <property>
                            <name>dnameCn</name>
                          </property>
                          <property>
                            <name>dnameOu</name>
                          </property>
                          <property>
                            <name>dnameL</name>
                          </property>
                          <property>
                            <name>dnameSt</name>
                          </property>
                          <property>
                            <name>dnameO</name>
                          </property>
                          <property>
                            <name>dnameC</name>
                          </property>
                          <property>
                            <name>alias</name>
                          </property>
                          <property>
                            <name>verify</name>
                          </property>
                          <property>
                            <name>maxMemory</name>
                          </property>
                          <property>
                            <name>tsaLocation</name>
                          </property>
                          <property>
                            <name>httpProxyHost</name>
                          </property>
                          <property>
                            <name>httpProxyPort</name>
                          </property>
                          <property>
                            <name>httpsProxyHost</name>
                          </property>
                          <property>
                            <name>httpsProxyPort</name>
                          </property>
                        </properties>
                        <ignoredProperties>
                          <ignore>verbose</ignore>
                          <ignore>securityDispatcher</ignore>
                          <!-- Add this as property if you explicitly configured it -->
                          <ignore>arguments</ignore>
                        </ignoredProperties>
                      </inputs>
                      <nestedProperties>
                        <property>
                          <name>keystoreConfig</name>
                          <inputs>
                            <properties>
                              <property>
                                <name>delete</name>
                              </property>
                              <property>
                                <name>gen</name>
                              </property>
                            </properties>
                          </inputs>
                        </property>
                      </nestedProperties>
                    </property>
                  </nestedProperties>
                  <outputs>
                    <cacheableBecause>signing artifacts is CPU-bound</cacheableBecause>
                    <files>
                      <file>
                        <name>archive</name>
                      </file>
                    </files>
                    <directories>
                      <directory>
                        <name>workDirectory</name>
                      </directory>
                    </directories>
                  </outputs>
                </plugin>
              </plugins>
            </develocity>
          </configuration>
        </plugin>
      </plugins>
    </pluginManagement>
  </build>
</project>
